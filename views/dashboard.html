<!DOCTYPE html>
<html lang="fr">
<head>
  <meta charset="UTF-8">
  <meta name="viewport" content="width=device-width, initial-scale=1.0">
  <title>Rackoon Streaming</title>
  <link rel="stylesheet" href="../css/dashboard.css">
  <link rel="stylesheet" href="../css/modal.css">
  <link rel="stylesheet" href="../css/video-player.css">
  <link rel="stylesheet" href="../css/import-classification.css">
  <link rel="stylesheet" href="https://cdnjs.cloudflare.com/ajax/libs/font-awesome/6.4.0/css/all.min.css">
</head>
<body>
  <!-- Barre de navigation -->
  <nav class="navbar">
    <div class="navbar-left">
      <div class="logo">RACKOON</div>
      <div class="nav-links">
        <a href="#" class="nav-link active">
          <i class="fas fa-home"></i>
          Accueil
        </a>
        <a href="file-manager-electron.html" class="nav-link">
          <i class="fas fa-folder-open"></i>
          Gestion des fichiers
        </a>
      </div>
    </div>
    <div class="user-controls">
      <div class="user-profile">
        <span id="username"></span>
      </div>
      <button id="logout-btn" class="btn-logout">D√©connexion</button>
    </div>
  </nav>

  <!-- Contenu principal -->
  <main class="main-content">
    <!-- Zone de chargement -->
    <div class="loading-container" id="loading-container">
      <div class="status-message" id="status-message">Pr√™t √† rechercher des vid√©os</div>
      <div class="progress-bar-container">
        <div class="progress-bar" id="progress-bar"></div>
      </div>
    </div>

    <!-- Section des m√©dias -->
    <div class="section-header">
      <h2 class="section-title">M√©dias Tri√©s</h2>
      <div class="filters-search-container">
        <div class="search-filter">
          <span class="search-icon">
            <i class="fas fa-search"></i>
          </span>
          <input type="text" id="filter-search" placeholder="Rechercher un titre...">
        </div>
        <button class="filter-button" id="filter-btn">
          <span class="filter-icon">
            <svg xmlns="http://www.w3.org/2000/svg" viewBox="0 0 24 24" width="24" height="24" fill="none" stroke="currentColor" stroke-width="2">
              <polygon points="22 3 2 3 10 12.46 10 19 14 21 14 12.46 22 3"></polygon>
            </svg>
          </span>
          Filtres
        </button>
      </div>
    </div>

    <div class="media-grid" id="media-grid">
      <!-- Les m√©dias seront ajout√©s ici dynamiquement -->
      <div class="empty-state">
        <span class="icon">üìº</span>
        <p>Aucune vid√©o trouv√©e. Utilisez le bouton + pour lancer une recherche.</p>
      </div>
    </div>
  </main>

  <!-- Bouton d'action flottant -->
  <div class="floating-action" id="add-btn">
    <span class="plus-icon">+</span>
  </div>

  <!-- Menu flottant pour le scan -->
  <div class="floating-menu" id="scan-menu">
    <h3>Ajouter des m√©dias</h3>
    <div class="scan-actions">
      <button class="scan-btn" id="scan-folder-btn">
        <span class="icon"><i class="fas fa-folder-open"></i></span>
        Rechercher un dossier
      </button>
      <button class="scan-btn" id="scan-file-btn">
        <span class="icon"><i class="fas fa-file-video"></i></span>
        Rechercher un fichier
      </button>
    </div>
  </div>

    <!-- Template pour les cartes de films -->
    <template id="media-card-template">
      <div class="media-card" data-id="" data-title="">
        <div class="media-thumbnail-container">
          <img src="" alt="" class="media-thumbnail">
        </div>
        <div class="media-info">
          <div class="media-title-container">
            <h3 class="media-title"></h3>
            <div class="watch-top">
              <button class="btn-watch-toggle">√† voir</button>
            </div>
          </div>
          <div class="media-extended-info">
            <div class="media-duration">
              Dur√©e: <span class="duration-value"></span>
            </div>
            <div class="rating-container">
              <div class="stars-container">
                <span class="star" data-value="1"><i class="fas fa-star"></i></span>
                <span class="star" data-value="2"><i class="fas fa-star"></i></span>
                <span class="star" data-value="3"><i class="fas fa-star"></i></span>
                <span class="star" data-value="4"><i class="fas fa-star"></i></span>
                <span class="star" data-value="5"><i class="fas fa-star"></i></span>
              </div>
            </div>
          </div>
        </div>
      </div>
    </template>

  <!-- Modal de pr√©sentation du film -->
  <div class="modal-overlay" id="modal-overlay">
    <div class="movie-modal" id="movie-modal">
      <button class="modal-close" id="modal-close">√ó</button>
      
      <!-- Mode visualisation -->
      <div class="view-mode" id="view-mode">
        <div class="modal-poster">
          <img src="../public/img/default-thumbnail.svg" alt="Poster du film" id="modal-poster">
        </div>
        
        <div class="modal-content">
          <div class="modal-header">
            <h2 class="modal-title" id="modal-title">Le Comte de Monte Cristo</h2>
            <span class="movie-year" id="movie-year">(2024)</span>
            <button class="edit-button" id="edit-button">
              <i class="fas fa-pencil-alt"></i>
            </button>
          </div>
          
          <div class="movie-meta">
            <div class="release-date" id="release-date"></div>
            <div class="duration" id="duration">2h 35m</div>
          </div>
          
          <div class="genres-container" id="genres-container">
            <span class="genre-tag"></span>
            <span class="genre-tag"></span>
            <span class="genre-tag"></span>
          </div>
          
          <div class="rating-section">
            <div class="modal-stars">
              <span class="modal-star" data-value="1"><i class="fas fa-star"></i></span>
              <span class="modal-star" data-value="2"><i class="fas fa-star"></i></span>
              <span class="modal-star" data-value="3"><i class="fas fa-star"></i></span>
              <span class="modal-star" data-value="4"><i class="fas fa-star"></i></span>
              <span class="modal-star" data-value="5"><i class="fas fa-star"></i></span>
            </div>
          </div>
          
          <div class="synopsis">
            <h3 class="synopsis-title">Synopsis</h3>
            <div class="synopsis-content" id="synopsis-content"></div>
          </div>
          
          <div class="modal-actions">
            <button class="btn-watch-toggle-modal" id="btn-watch-toggle-modal">√Ä voir</button>
            <button class="btn-watch-film" id="btn-watch-film">Regarder le film</button>
          </div>
        </div>
      </div>
      
      <!-- Mode √©dition (initialement cach√©) -->
      <div class="edit-mode" id="edit-mode" style="display: none;">
        <div class="modal-content">
          <!-- Titre du mode √©dition -->
          <div class="edit-header">
            <h2>Sortir du mode √©dition</h2>
          </div>
          
          <!-- Bouton de recherche sur TMDB -->
          <button class="tmdb-search-btn" id="tmdb-search-btn">
            <i class="fas fa-search"></i> Rechercher sur The Movie Database
          </button>
          
          <!-- Titre -->
          <div class="edit-section">
            <div class="edit-section-title">Nom</div>
            <div class="edit-field">
              <input type="text" id="edit-title-input" placeholder="Titre du film">
            </div>
          </div>
          
          <!-- Ann√©e et date de sortie -->
          <div class="edit-section">
            <div class="edit-section-title">Date de sortie</div>
            <div class="edit-field">
              <input type="date" id="edit-release-date" placeholder="Date de sortie">
            </div>
          </div>
          
          <!-- Genres -->
          <div class="edit-section">
            <div class="edit-section-title">Genres</div>
            <!-- Genres pr√©d√©finis -->
            <div class="edit-field genre-selection">
              <select class="genre-dropdown" id="genre-dropdown">
                <option value="">Choisir un genre</option>
                <option value="Action">Action</option>
                <option value="Aventure">Aventure</option>
                <option value="Animation">Animation</option>
                <option value="Com√©die">Com√©die</option>
                <option value="Crime">Crime</option>
                <option value="Documentaire">Documentaire</option>
                <option value="Drame">Drame</option>
                <option value="Famille">Famille</option>
                <option value="Fantastique">Fantastique</option>
                <option value="Histoire">Histoire</option>
                <option value="Horreur">Horreur</option>
                <option value="Musique">Musique</option>
                <option value="Myst√®re">Myst√®re</option>
                <option value="Romance">Romance</option>
                <option value="Science-Fiction">Science-Fiction</option>
                <option value="Thriller">Thriller</option>
                <option value="Guerre">Guerre</option>
                <option value="Western">Western</option>
              </select>
              <button class="add-genre-btn" id="add-predefined-genre">Ajouter</button>
            </div>
            
            <!-- Affichage des genres s√©lectionn√©s -->
            <div class="genres-edit" id="edit-genres-container">
              <!-- Les genres seront ajout√©s ici dynamiquement -->
            </div>
            
            <!-- Ajout de genres personnalis√©s -->
            <div class="add-genre-container">
              <input type="text" class="add-genre-input" id="custom-genre-input" placeholder="Genre personnalis√©">
              <button class="add-genre-btn" id="add-custom-genre">Ajouter</button>
            </div>
          </div>
          
          <!-- Image -->
          <div class="edit-section">
            <div class="edit-section-title">Image</div>
            <div class="image-upload-container">
              <img src="../public/img/default-thumbnail.svg" class="image-upload-preview" id="image-preview">
              <div class="image-upload-controls">
                <button class="image-upload-btn" id="upload-image-btn">Changer l'image</button>
              </div>
            </div>
          </div>
          
          <!-- Synopsis -->
          <div class="edit-section">
            <div class="edit-section-title">Synopsis</div>
            <div class="edit-field">
              <textarea id="edit-synopsis-input" placeholder="Synopsis du film"></textarea>
            </div>
          </div>
          
          <!-- Boutons d'action -->
          <button class="save-changes-btn" id="save-changes-btn">Enregistrer les modifications</button>
          <button class="exit-edit-mode" id="exit-edit-mode">Sortir du mode √©dition</button>
        </div>
      </div>
    </div>
  </div>

  <!-- Modal Phase 1 : Tri par type - √Ä ajouter dans dashboard.html -->
  <div id="import-modal" class="import-modal" style="display: none;">
    <div class="import-modal-content">
      <div class="import-modal-header">
        <h2>Classification des m√©dias import√©s</h2>
        <span class="import-modal-count" id="import-count">0 fichiers trouv√©s</span>
      </div>
      
      <div class="import-modal-body">
        <div class="import-table-container">
          <table class="import-table" id="import-table">
            <thead>
              <tr>
                <th>Aper√ßu</th>
                <th>Nom du fichier</th>
                <th>Dur√©e</th>
                <th>Taille</th>
                <th>Type</th>
                <th>Actions</th>
              </tr>
            </thead>
            <tbody id="import-table-body">
              <!-- Les lignes seront ajout√©es dynamiquement -->
            </tbody>
          </table>
        </div>
      </div>
      
      <div class="import-modal-footer">
        <div class="import-actions">
          <button class="btn-secondary" id="skip-all-btn">Tout passer (non tri√©)</button>
          <button class="btn-primary" id="validate-import-btn">Valider la s√©lection</button>
        </div>
        <div class="import-progress" id="import-progress" style="display: none;">
          <div class="progress-bar">
            <div class="progress-fill" id="import-progress-fill"></div>
          </div>
          <span class="progress-text" id="import-progress-text">Enregistrement en cours...</span>
        </div>
      </div>
    </div>
  </div>

  <!-- Template pour les lignes du tableau -->
  <template id="import-row-template">
    <tr class="import-row" data-file-index="">
      <td class="thumbnail-cell">
        <div class="file-thumbnail">
          <img src="" alt="" class="thumbnail-preview">
        </div>
      </td>
      <td class="filename-cell">
        <div class="filename-info">
          <span class="filename-title"></span>
          <span class="filename-path"></span>
        </div>
      </td>
      <td class="duration-cell">
        <span class="duration-value">--:--:--</span>
      </td>
      <td class="size-cell">
        <span class="size-value">-- MB</span>
      </td>
      <td class="type-cell">
        <select class="type-selector">
          <option value="unsorted">√Ä d√©finir</option>
          <option value="film">üé¨ Film</option>
          <option value="series">üì∫ S√©rie</option>
          <option value="short">üéûÔ∏è Court m√©trage</option>
          <option value="other">üìÅ Autre</option>
        </select>
      </td>
      <td class="actions-cell">
        <button class="btn-small btn-outline quick-skip" title="Passer ce fichier">Passer</button>
      </td>
    </tr>
  </template>

  <!-- Modal Phase 2 : Classification d√©taill√©e (s√©ries, m√©tadonn√©es) -->
  <div id="details-classification-modal" class="import-modal" style="display: none;">
    <div class="import-modal-content details-modal">
      <div class="import-modal-header">
        <h2>Classification d√©taill√©e</h2>
        <div class="file-info">
          <span id="detail-file-name">Nom du fichier</span>
        </div>
      </div>
      
      <div class="import-modal-body details-body">
        <div class="details-form">
          <div class="form-row">
            <div class="form-group">
              <label for="detail-title">Titre *</label>
              <input type="text" id="detail-title" class="form-control" placeholder="Titre du m√©dia" required>
            </div>
            <div class="form-group">
              <label for="detail-category">Cat√©gorie *</label>
              <select id="detail-category" class="form-control" required>
                <option value="">S√©lectionner une cat√©gorie</option>
              </select>
            </div>
          </div>

          <div class="form-row" id="series-section" style="display: none;">
            <div class="form-group">
              <label for="detail-series">S√©rie</label>
              <div class="series-input-container">
                <select id="detail-series" class="form-control">
                  <option value="">S√©lectionner une s√©rie</option>
                </select>
                <button type="button" id="new-series-btn" class="btn-small btn-outline">+ Nouvelle s√©rie</button>
              </div>
            </div>
            <div class="form-group">
              <label for="detail-season">Saison</label>
              <input type="number" id="detail-season" class="form-control" placeholder="1" min="1">
            </div>
            <div class="form-group">
              <label for="detail-episode">√âpisode</label>
              <input type="number" id="detail-episode" class="form-control" placeholder="1" min="1">
            </div>
          </div>

          <div class="form-row">
            <div class="form-group">
              <label for="detail-year">Ann√©e</label>
              <input type="number" id="detail-year" class="form-control" placeholder="2023" min="1900" max="2030">
            </div>
            <div class="form-group">
              <label for="detail-release-date">Date de sortie</label>
              <input type="date" id="detail-release-date" class="form-control">
            </div>
          </div>

          <div class="form-group">
            <label for="detail-description">Description</label>
            <textarea id="detail-description" class="form-control" rows="3" placeholder="Description du m√©dia (optionnel)"></textarea>
          </div>
        </div>
      </div>
      
      <div class="import-modal-footer">
        <div class="import-actions">
          <button class="btn-secondary" id="skip-file-btn">Passer ce fichier</button>
          <button class="btn-primary" id="save-file-btn">Enregistrer</button>
        </div>
      </div>
    </div>
  </div>

  <!-- Modal pour nouvelle s√©rie -->
  <div id="new-series-modal" class="import-modal" style="display: none;">
    <div class="import-modal-content small-modal">
      <div class="import-modal-header">
        <h3>Cr√©er une nouvelle s√©rie</h3>
      </div>
      
      <div class="import-modal-body">
        <div class="form-group">
          <label for="new-series-name">Nom de la s√©rie *</label>
          <input type="text" id="new-series-name" class="form-control" placeholder="Ex: Breaking Bad" required>
        </div>
        <div class="form-group">
          <label for="new-series-description">Description</label>
          <textarea id="new-series-description" class="form-control" rows="2" placeholder="Description de la s√©rie (optionnel)"></textarea>
        </div>
      </div>
      
      <div class="import-modal-footer">
        <div class="import-actions">
          <button class="btn-secondary" id="cancel-series-btn">Annuler</button>
          <button class="btn-primary" id="create-series-btn">Cr√©er</button>
        </div>
      </div>
    </div>
  </div>

  <!-- CSS pour la modal -->
  <style>
  .import-modal {
    position: fixed;
    top: 0;
    left: 0;
    width: 100%;
    height: 100%;
    background-color: rgba(0, 0, 0, 0.8);
    z-index: 2000;
    display: flex;
    justify-content: center;
    align-items: center;
  }

  .import-modal-content {
    background-color: #081029;
    border-radius: 15px;
    width: 95%;
    max-width: 1200px;
    max-height: 90vh;
    display: flex;
    flex-direction: column;
    box-shadow: 0 20px 60px rgba(0, 0, 0, 0.5);
    border: 1px solid rgba(255, 255, 255, 0.1);
  }

  .import-modal-header {
    padding: 25px 30px;
    border-bottom: 1px solid rgba(255, 255, 255, 0.1);
    display: flex;
    justify-content: space-between;
    align-items: center;
  }

  .import-modal-header h2 {
    color: #ffffff;
    font-size: 24px;
    font-weight: 600;
    margin: 0;
  }

  .import-modal-count {
    color: #b0b0b0;
    font-size: 14px;
    background-color: rgba(255, 255, 255, 0.1);
    padding: 6px 12px;
    border-radius: 12px;
  }

  .import-modal-body {
    flex: 1;
    overflow: hidden;
    padding: 20px 30px;
  }

  .import-table-container {
    height: 100%;
    overflow-y: auto;
    border-radius: 8px;
    border: 1px solid rgba(255, 255, 255, 0.1);
  }

  .import-table {
    width: 100%;
    border-collapse: collapse;
    background-color: rgba(255, 255, 255, 0.05);
  }

  .import-table th {
    background-color: rgba(255, 255, 255, 0.1);
    color: #ffffff;
    font-weight: 600;
    padding: 15px 12px;
    text-align: left;
    border-bottom: 1px solid rgba(255, 255, 255, 0.1);
    position: sticky;
    top: 0;
    z-index: 10;
  }

  .import-table td {
    padding: 12px;
    border-bottom: 1px solid rgba(255, 255, 255, 0.05);
    color: #e0e0e0;
  }

  .import-row:hover {
    background-color: rgba(255, 255, 255, 0.05);
  }

  .file-thumbnail {
    width: 60px;
    height: 40px;
    border-radius: 4px;
    overflow: hidden;
    background-color: #2a2a3e;
    display: flex;
    align-items: center;
    justify-content: center;
  }

  .thumbnail-preview {
    width: 100%;
    height: 100%;
    object-fit: cover;
  }

  .filename-info {
    display: flex;
    flex-direction: column;
    gap: 4px;
  }

  .filename-title {
    font-weight: 500;
    color: #ffffff;
  }

  .filename-path {
    font-size: 12px;
    color: #a0a0a0;
    overflow: hidden;
    text-overflow: ellipsis;
    white-space: nowrap;
    max-width: 200px;
  }

  .type-selector {
    background-color: rgba(255, 255, 255, 0.1);
    border: 1px solid rgba(255, 255, 255, 0.2);
    color: #ffffff;
    padding: 8px 12px;
    border-radius: 6px;
    font-size: 14px;
    cursor: pointer;
    min-width: 140px;
  }

  .type-selector:focus {
    outline: none;
    border-color: #3474db;
  }

  .type-selector option {
    background-color: #081029;
    color: #ffffff;
  }

  .btn-small {
    padding: 6px 12px;
    font-size: 12px;
    border-radius: 4px;
    cursor: pointer;
    border: none;
    transition: all 0.3s;
  }

  .btn-outline {
    background-color: transparent;
    border: 1px solid rgba(255, 255, 255, 0.3);
    color: #ffffff;
  }

  .btn-outline:hover {
    background-color: rgba(255, 255, 255, 0.1);
  }

  .import-modal-footer {
    padding: 25px 30px;
    border-top: 1px solid rgba(255, 255, 255, 0.1);
    display: flex;
    justify-content: space-between;
    align-items: center;
  }

  .import-actions {
    display: flex;
    gap: 15px;
  }

  .btn-secondary {
    background-color: rgba(255, 255, 255, 0.1);
    color: #ffffff;
    border: 1px solid rgba(255, 255, 255, 0.2);
    padding: 10px 20px;
    border-radius: 6px;
    cursor: pointer;
    transition: all 0.3s;
  }

  .btn-secondary:hover {
    background-color: rgba(255, 255, 255, 0.15);
  }

  .btn-primary {
    background-color: #3474db;
    color: #ffffff;
    border: none;
    padding: 10px 25px;
    border-radius: 6px;
    cursor: pointer;
    font-weight: 600;
    transition: all 0.3s;
  }

  .btn-primary:hover {
    background-color: #2a5db3;
  }

  .import-progress {
    display: flex;
    align-items: center;
    gap: 15px;
  }

  .progress-bar {
    width: 200px;
    height: 6px;
    background-color: rgba(255, 255, 255, 0.1);
    border-radius: 3px;
    overflow: hidden;
  }

  .progress-fill {
    height: 100%;
    background-color: #3474db;
    width: 0%;
    transition: width 0.3s ease;
  }

  .progress-text {
    color: #b0b0b0;
    font-size: 14px;
    white-space: nowrap;
  }

  /* Responsive */
  @media (max-width: 1024px) {
    .import-modal-content {
      width: 98%;
      max-height: 95vh;
    }
    
    .import-table {
      font-size: 14px;
    }
    
    .filename-path {
      max-width: 150px;
    }
  }

  @media (max-width: 768px) {
    .import-modal-header {
      flex-direction: column;
      gap: 10px;
      align-items: flex-start;
    }
    
    .import-modal-footer {
      flex-direction: column;
      gap: 15px;
      align-items: stretch;
    }
    
    .import-actions {
      justify-content: center;
    }
  }

  /* Styles pour la modal de classification d√©taill√©e */
  .details-modal {
    max-width: 800px;
  }

  .details-body {
    overflow-y: auto;
  }

  .details-form {
    display: flex;
    flex-direction: column;
    gap: 20px;
  }

  .form-row {
    display: grid;
    grid-template-columns: 1fr 1fr;
    gap: 20px;
  }

  .form-row.three-columns {
    grid-template-columns: 1fr 1fr 1fr;
  }

  .form-group {
    display: flex;
    flex-direction: column;
    gap: 8px;
  }

  .form-group.full-width {
    grid-column: 1 / -1;
  }

  .form-group label {
    color: #ffffff;
    font-size: 14px;
    font-weight: 500;
  }

  .form-control {
    background-color: rgba(255, 255, 255, 0.1);
    border: 1px solid rgba(255, 255, 255, 0.2);
    border-radius: 6px;
    padding: 10px 12px;
    color: #ffffff;
    font-size: 14px;
    transition: all 0.3s;
  }

  .form-control:focus {
    outline: none;
    border-color: #3474db;
    background-color: rgba(255, 255, 255, 0.15);
  }

  .form-control::placeholder {
    color: rgba(255, 255, 255, 0.5);
  }

  .series-input-container {
    display: flex;
    gap: 10px;
    align-items: flex-end;
  }

  .series-input-container .form-control {
    flex: 1;
  }

  .file-info {
    background-color: rgba(255, 255, 255, 0.1);
    padding: 8px 12px;
    border-radius: 6px;
    font-size: 14px;
    color: #b0b0b0;
  }

  #series-section {
    border-top: 1px solid rgba(255, 255, 255, 0.1);
    padding-top: 20px;
    margin-top: 10px;
  }

  .small-modal {
    max-width: 500px;
  }

  .btn-small {
    padding: 6px 12px;
    font-size: 12px;
    white-space: nowrap;
  }

  .btn-outline {
    background-color: transparent;
    border: 1px solid rgba(255, 255, 255, 0.3);
    color: #ffffff;
  }

  .btn-outline:hover {
    background-color: rgba(255, 255, 255, 0.1);
    border-color: rgba(255, 255, 255, 0.5);
  }

  @media (max-width: 768px) {
    .form-row {
      grid-template-columns: 1fr;
      gap: 15px;
    }
    
    .series-input-container {
      flex-direction: column;
      align-items: stretch;
    }
    
    .details-modal {
      width: 98%;
    }
  }
  </style>  

  <!-- Scripts -->
  <script src="../js/utils.js"></script>
  <script src="../js/dashboard.js"></script>
  <script src="../js/movie-modal.js"></script>
  <script src="../js/video-player.js"></script>
  <script src="../js/dashboard-categories.js"></script>
  <script src="../js/import-classification.js"></script>
  <script src="../js/import-simple.js"></script>
</body>
</html>